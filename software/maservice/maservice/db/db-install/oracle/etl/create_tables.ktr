<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>pre_processing</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
      <read/>
      <write/>
      <input/>
      <output/>
      <update/>
      <rejected/>
      <connection/>
      <table/>
      <step_performance_table/>
      <use_batchid>Y</use_batchid>
      <use_logfield>N</use_logfield>
      <size_limit_lines/>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <modified_user>-</modified_user>
  <modified_date>2010&#47;08&#47;16 10:21:32.044</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>cabio</name>
    <server>${cabio_db_host_name}</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>${cabio_db_name}</database>
    <port>${cabio_db_port_number}</port>
    <username>${cabio_db_username}</username>
    <password>${cabio_db_password}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${cabio_db_port_number}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  </order>
  <step>
    <name>Execute SQL script</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>cabio</connection>
    <execute_each_row>N</execute_each_row>
    <replace_variables>Y</replace_variables>
    <sql>DROP TABLE zstg_ma_feature;
DROP TABLE zstg_ma_rel_gene_nas_variation;
DROP TABLE zstg_ma_physical_location;
DROP TABLE ma_search_criteria;
DROP TABLE ma_allele;
DROP TABLE ma_database_cross_reference;
DROP TABLE ma_rel_feature_ms_annotation;
DROP TABLE ma_molecular_seq_annotation;
DROP TABLE ma_disease;
DROP TABLE ma_therapeutic_agent;
DROP TABLE ma_rel_gene_array_reporter;
DROP TABLE ma_rel_location_feature;    
DROP TABLE ma_physical_location;
DROP TABLE ma_array_reporter;
DROP TABLE ma_microarray;
DROP TABLE ma_rel_gene_nas_variation;
DROP TABLE ma_homologous_association;
DROP TABLE ma_feature;
DROP TABLE ma_organism;
DROP TABLE ma_chromosome;
DROP TABLE ma_genome;



DROP sequence ma_genome_pk;
DROP sequence ma_chromosome_pk;
DROP sequence ma_organism_pk;
DROP sequence ma_feature_pk;
DROP sequence ma_microarray_pk;
DROP sequence ma_array_reporter_pk;
DROP sequence ma_physical_location_pk;
DROP sequence ma_therapeutic_agent_pk;
DROP sequence ma_disease_pk;
DROP sequence ma_molecular_seq_annotation_pk;
DROP sequence ma_database_cross_reference_pk;
DROP sequence ma_homologous_association_pk;
DROP sequence ma_allele_pk;


create table zstg_ma_feature
(
  id             number,
  gene_id        number,
  chromosome_id  number,
  chr_start      number,
  chr_stop       number,
  orientation    VARCHAR2(20),
  organism_id    number,
  location_id    number,
  type           varchar2(30 byte)
)tablespace ${load_tablspc};

create table zstg_ma_rel_gene_nas_variation
(
  gene_id           number                      not null,
  nas_variation_id  number                      not null
)tablespace ${load_tablspc};

create table zstg_ma_physical_location
(
  id                 number,
  chromosome_id      number,
  start_coordinate   number,
  end_coordinate     number,
  orientation        varchar2(10 byte),
  array_reporter_id  number,
  gene_id            number,
  snp_id             number
)tablespace ${load_tablspc};

   
CREATE TABLE ma_genome (
                        id NUMBER, 
                        assembly_source VARCHAR2(50),
                        assembly_version VARCHAR2(50), 
                        primary key (id)
                        ) TABLESPACE ${prod_tablspc};

CREATE TABLE ma_chromosome 
                          (
                            id NUMBER,
                            name VARCHAR2(50), 
                            genome_id NUMBER, 
                            organism_id NUMBER,
                            primary key (id)
                           ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_organism(
                         id NUMBER, 
                         scientific_name VARCHAR2(50), 
                         common_name  VARCHAR2(50), 
                         ncbi_taxonomy_id_root VARCHAR2(128),
                         ncbi_taxonomy_id_extension VARCHAR2(128),
                         taxonomy_rank_code VARCHAR2(50),
                         taxonomy_rank_codesys VARCHAR2(50),
                         taxonomy_rank_codesys_version  VARCHAR2(50),
	                      taxonomy_rank_codesys_name  VARCHAR2(50),
                         taxonomy_rank_originaltext  VARCHAR2(50),
                         primary key (id)
                         ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_feature
                         (
                          id NUMBER, 
                          full_name VARCHAR2(500), 
                          symbol VARCHAR2(50), 
                          feature_type VARCHAR2(30),
                          amino_acid_change VARCHAR2(30),
                          chr_x_pseudo_autosomal_region varchar2(50), 
                          coding_status VARCHAR2(10), 
                          flank VARCHAR2(55), 
                          validation_status VARCHAR2(50),
                          organism_id NUMBER, 
                          discriminator VARCHAR2(100),  
                          feature_id NUMBER,
                          primary key (id)

                        ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_microarray (
                            id NUMBER, 
                            array_name VARCHAR2(50), 
                            description VARCHAR2(100), 
                            platform VARCHAR2(50),
                            annotation_date DATE, 
                            annotation_version VARCHAR2(50), 
                            dbsnp_version VARCHAR2(50), 
                            genome_version VARCHAR2(100), 
                            type VARCHAR2(50),
                            lsid_root  VARCHAR2(50),
                            lsid_extension VARCHAR2(100), primary key (id)   
                            ) TABLESPACE ${prod_tablspc};




CREATE TABLE ma_array_reporter(
                               id NUMBER, 
                               name VARCHAR2(50), 
                               microarray_id NUMBER, 
                               primary key (id)) TABLESPACE ${prod_tablspc};



CREATE TABLE ma_physical_location
                             (
                              id NUMBER, 
                              chromosome_id NUMBER,
                              start_coordinate NUMBER, 
                              end_coordinate NUMBER,                               
                              orientation VARCHAR2(10), 
                              array_reporter_id NUMBER, 
                              primary key (id)
                              ) TABLESPACE ${prod_tablspc};

CREATE TABLE ma_rel_location_feature
                             (
                                  feature_id NUMBER NOT NULL,
	                               location_id  NUMBER NOT NULL
                              ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_rel_gene_nas_variation
                             (
                                  gene_id NUMBER NOT NULL,
	                               nas_variation_id  NUMBER NOT NULL
                              ) TABLESPACE ${prod_tablspc};



CREATE TABLE ma_rel_gene_array_reporter
                             (
                              gene_id NUMBER, 
                              array_reporter_id NUMBER
                              ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_disease
                              (
                                id NUMBER NOT NULL,
                                name_code VARCHAR2(50),
                                name_codesys VARCHAR2(128),
	                             name_codesys_name VARCHAR2(50),
	                             name_codesys_version VARCHAR2(100),
                                name_originaltext VARCHAR2(100),
	                             namecode_code VARCHAR2(50),
                                namecode_codesys VARCHAR2(128),
	                             namecode_codesys_name VARCHAR2(50),
	                             namecode_codesys_version  VARCHAR2(50),
                                namecode_originaltext  VARCHAR2(50),
                                primary key (id)
                               ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_therapeutic_agent
                              (	
                                 id NUMBER NOT NULL,
	                              description  VARCHAR2(110),
                                 name_code   VARCHAR2(50),
                                 name_codesys VARCHAR2(128),
                                 name_codesys_name VARCHAR2(50),
	                              name_codesys_version VARCHAR2(50),
	                              name_originaltext VARCHAR2(300),
	                              namecode_code VARCHAR2(50),
                                 namecode_codesys VARCHAR2(128),
	                              namecode_codesys_name VARCHAR2(50),
                                 namecode_codesys_version VARCHAR2(50),
                                 namecode_originaltext  VARCHAR2(50),
                                 primary key (id)
                               ) TABLESPACE ${prod_tablspc};



CREATE TABLE ma_molecular_seq_annotation
                              (
                               	id NUMBER,
	                              source VARCHAR2(50),
                                 term_code VARCHAR2(50),
                                 term_codesys VARCHAR2(128),
	                              term_codesys_name VARCHAR2(50),
	                              term_codesys_version  VARCHAR2(50),
	                              term_originaltext VARCHAR2(200),
                                 role_code VARCHAR2(50),
                                 role_codesys VARCHAR2(128),
	                              role_codesys_name VARCHAR2(50),
                                 role_codesys_version  VARCHAR2(50),
                                 role_originaltext VARCHAR2(100),
                              	therapeutic_agent_id NUMBER,
	                              disease_id NUMBER,
                              	discriminator VARCHAR2(100),
                                 primary key (id)

                               ) TABLESPACE ${prod_tablspc};

CREATE TABLE ma_rel_feature_ms_annotation
                                (
	                                molecular_seq_annotation_id  NUMBER NOT NULL,
	                                feature_id  NUMBER NOT NULL
                                ) TABLESPACE ${prod_tablspc};

CREATE TABLE ma_database_cross_reference
                                    (
                                       id NUMBER NOT NULL,
                                       identifier_root VARCHAR2(50),
	                                    identifier_extension VARCHAR2(50) NOT NULL,
	                                    discriminator VARCHAR2(100),
	                                    therapeutic_agent_id NUMBER,
                                       variation_id  NUMBER,
                                       gene_id NUMBER ,
                                       database_name_code  VARCHAR2(50),
	                                    database_name_codesys VARCHAR2(128),
                                       database_name_codesys_version  VARCHAR2(50),
	                                    database_name_codesys_name VARCHAR2(50),
                                       database_name_originaltext VARCHAR2(50),
                                       gene_alias_gene_id NUMBER,
                                       primary key (id)
                                    ) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_homologous_association
                                (
	                                id  NUMBER NOT NULL,
	                                similarity_percentage  float,
	                                gene_id NUMBER,
	                                homologous_gene_id NUMBER,
	                                 primary key (id)
                                ) TABLESPACE ${prod_tablspc};

CREATE TABLE ma_allele
(
	id        NUMBER NOT NULL,
	sequence  VARCHAR2(500),
	variation_id    NUMBER,
   primary key (id)
) TABLESPACE ${prod_tablspc};


CREATE TABLE ma_search_criteria
(
	id               NUMBER NOT NULL,
	symbol_or_alias  VARCHAR2(50),
	reporter_name    VARCHAR2(128),
	discriminator    VARCHAR2(50),
	organism_id      NUMBER(8,2),
	microarray_id    NUMBER,
   primary key (id)

)  TABLESPACE ${prod_tablspc};




ALTER TABLE ma_database_cross_reference ADD foreign key(therapeutic_agent_id) references ma_therapeutic_agent (ID) ON DELETE cascade;
ALTER TABLE ma_database_cross_reference ADD foreign key(variation_id) references ma_feature (ID) ON DELETE cascade;
ALTER TABLE ma_database_cross_reference ADD foreign key(gene_id) references ma_feature (ID) ON DELETE cascade;




ALTER TABLE ma_rel_feature_ms_annotation ADD foreign key(molecular_seq_annotation_id) references ma_molecular_seq_annotation (ID) ON DELETE cascade;
ALTER TABLE ma_rel_feature_ms_annotation ADD foreign key(feature_id) references ma_feature (ID) ON DELETE cascade;



ALTER TABLE ma_molecular_seq_annotation ADD foreign key(therapeutic_agent_id) references ma_therapeutic_agent(ID) ON DELETE cascade;
ALTER TABLE ma_molecular_seq_annotation ADD foreign key(disease_id) references ma_disease (ID) ON DELETE cascade;



ALTER TABLE ma_rel_gene_array_reporter ADD foreign key(gene_id) references ma_feature (ID) ON DELETE cascade;
ALTER TABLE ma_rel_gene_array_reporter ADD foreign key(array_reporter_id) references ma_array_reporter(ID) ON DELETE cascade;

ALTER TABLE ma_rel_location_feature ADD foreign key(feature_id) references ma_feature (ID) ON DELETE cascade;
ALTER TABLE ma_rel_location_feature ADD foreign key(location_id) references ma_physical_location (ID) ON DELETE cascade;


ALTER TABLE ma_physical_location ADD foreign key(array_reporter_id) references ma_array_reporter(ID) ON DELETE cascade;
ALTER TABLE ma_physical_location ADD foreign key(chromosome_id) references ma_chromosome(ID) ON DELETE cascade;


ALTER TABLE ma_array_reporter ADD foreign key(microarray_id) references ma_microarray(ID) ON DELETE cascade;
                                                                       

ALTER TABLE ma_rel_gene_nas_variation  ADD foreign key (gene_id) references ma_feature (ID) ON DELETE cascade;
ALTER TABLE ma_rel_gene_nas_variation  ADD foreign key (nas_variation_id) references ma_feature (ID) ON DELETE cascade;



ALTER TABLE ma_feature ADD foreign key(organism_id) references ma_organism(ID) ON DELETE cascade;
ALTER TABLE ma_feature ADD foreign key(feature_id) references ma_feature(ID) ON DELETE cascade;


ALTER TABLE ma_chromosome ADD foreign key(genome_id) references ma_genome(ID) ON DELETE cascade; 

ALTER TABLE ma_homologous_association ADD foreign key(gene_id) references ma_feature(ID) ON DELETE cascade;
ALTER TABLE ma_homologous_association ADD foreign key(homologous_gene_id) references ma_feature(ID) ON DELETE cascade;
           

ALTER TABLE ma_allele ADD foreign key(variation_id) references ma_feature(ID) ON DELETE cascade;

ALTER TABLE ma_search_criteria ADD  foreign key(organism_id) references ma_organism(ID) ON DELETE cascade;
ALTER TABLE ma_search_criteria ADD  foreign key(microarray_id) references ma_microarray(ID) ON DELETE cascade;



CREATE sequence ma_genome_pk;
CREATE sequence ma_chromosome_pk;
CREATE sequence ma_organism_pk;
CREATE sequence ma_feature_pk START WITH 500000;
CREATE sequence ma_microarray_pk;
CREATE sequence ma_array_reporter_pk;
CREATE sequence ma_physical_location_pk START WITH 90000000;
CREATE sequence ma_therapeutic_agent_pk;
CREATE sequence ma_disease_pk;
CREATE sequence ma_molecular_seq_annotation_pk;
CREATE sequence ma_database_cross_reference_pk START WITH 30000000;
CREATE sequence ma_homologous_association_pk;
CREATE sequence ma_allele_pk;

</sql>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>192</xloc>
      <yloc>85</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
